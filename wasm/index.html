<html>
	<head>
		<meta charset="utf-8">
		<script src="wasm_exec.js"></script>
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/themes/prism-coy.min.css">
		<script>
			var console = {
				log: (s) => document.getElementById('out').innerHTML += `> [LOG] ${s}\n`,
				warn: (s) => document.getElementById('out').innerHTML += `> [WARN] ${s}\n`,
				error: (s) => document.getElementById('out').innerHTML += `> [ERROR] ${s}\n`,
			};
			const go = new Go();
			WebAssembly.instantiateStreaming(fetch("gauge.wasm"), go.importObject).then((result) => {
				go.run(result.instance);
			});

			var stepRegistry = {};
			var generalize = (s) => s.replace(/(<.*?>)|(".*?")/g, "{}");
			const caller_file = "step_implementation.js";
			var step = (text, f) => { 
				var s = stepRegistry[generalize(text)];
				var caller_line_no = (new Error).stack.split('\n')[1].split('> Function').pop();
				var caller_line = `${caller_file}${caller_line_no}`;
				if(s){
					s.push({func: f, location: caller_line})
				} else{
					stepRegistry[generalize(text)] = [{func: f, location: caller_line}]; 
				}
			};
			var beforeScenario = (f, opts) => {};
			var stepImplemented = (s) => generalize(s) in stepRegistry;
			var stepImplementationLocations = (s) => stepRegistry[s].map(i => i.location).join('|');
			var parse = () => {
				try {
					stepRegistry = {};
					new Function(document.getElementById('implementation').innerText)();	
				} catch (error) {
					console.error(error);
				}
			};
			var execute = (s, params) => {
				try {
					stepRegistry[s][0].func.apply({}, JSON.parse(params).map(x => x.kind === 'table' ? x.table : x.value));					
				} catch (error) {
					return error
				}
			}
		</script>
		<style>
			.container{
				display: flex;
				height: 70%;
			}
			pre {
				width: 100%;
				max-height: 100%;
			}
			.dark-block {
				background-color: #333;
				color: #ccc;
				padding: 1em;
				margin: 3em 0 0 1em;
			}
		</style>
	</head>
	<body>
		<header>
			<input type="button" id="parseButton" value="Parse"></input>
		</header>
		<div class="container">
			<pre>	
				<code class="language-md" contenteditable="true" id="specText">
# Specification Heading

This is an executable specification file. This file follows markdown syntax.
Every heading in this file denotes a scenario. Every bulleted point denotes a step.

To execute this specification, run

	gauge run specs


* Vowels in English language are "aeiou".

## Vowel counts in single word
tags: single word

* The word "gauge" has "3" vowels.

## Vowel counts in multiple word

This is the second scenario in this specification

Here's a step that takes a table

* Almost all words have vowels
	|Word  |Vowel Count|
	|------|-----------|
	|Gauge |3          |
	|Mingle|2          |
	|Snap  |1          |
	|GoCD  |1          |
	|Rhythm|0          |
				</code>
			</pre>
			<pre>
				<code class="language-js" contenteditable="true" id="implementation">
/* globals gauge*/

&quot;use strict&quot;;

//var assert = require(&quot;assert&quot;);

var vowels = [&quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;];

var numberOfVowels = function (word) {
	var vowelArr = word.split(&quot;&quot;).filter(function (elem) { return vowels.indexOf(elem) &gt; -1; });
	return vowelArr.length;
};

// --------------------------
// Gauge step implementations
// --------------------------

step(&quot;Vowels in English language are &lt;vowels&gt;.&quot;, function(vowelsGiven) {
	// assert.equal(vowelsGiven, vowels.join(&quot;&quot;));
});

step(&quot;The word &lt;word&gt; has &lt;number&gt; vowels.&quot;, function(word, number) {
	// assert.equal(number, numberOfVowels(word));
});

step(&quot;Almost all words have vowels &lt;table&gt;&quot;, function(table) {
	table.rows.forEach(function (row) {
	// assert.equal(numberOfVowels(row.cells[0]), parseInt(row.cells[1]));
	});
});

// ---------------
// Execution Hooks
// ---------------

beforeScenario(function () {
	// assert.equal(vowels.join(&quot;&quot;), &quot;aeiou&quot;);
});

beforeScenario(function () {
	assert.equal(vowels[0], &quot;a&quot;);
}, { tags: [ &quot;single word&quot; ]});
											
				</code>
			</pre>
		</div>
		<pre class="dark-block"><code id="out"></code></pre>
		<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/prism.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-javascript.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-markdown.min.js"></script>
	</body>
</html>
